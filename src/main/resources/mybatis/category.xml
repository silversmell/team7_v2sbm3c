<?xml version="1.0" encoding="UTF-8"?>
 
 <!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
 <mapper namespace="dev.mvc.categpry.CategoryDAOInter"> <!-- SB가 자동으로 구현하여 연동하는 interface -->
  
  <!-- 카테고리 등록 -->
  <insert id="create" parameterType="dev.mvc.category.CategoryVO"> <!-- public int create(CategoryVO categoryVO) {...-->
    INSERT INTO category(cate_no, cate_name, cate_cnt, cate_seqno, cate_visible)
    VALUES(category_seq.nextval, #{cate_name}, 0, #{cate_seqno}, 'Y')
  </insert>
   
   <!-- 카테고리 전체 조회 -->
  <select id="list_all" resultType="dev.mvc.category.CategoryVO">
    SELECT cate_no, cate_name, cate_cnt, cate_seqno, cate_visible
    FROM category
    ORDER BY cate_no ASC
  </select>
  
  <!-- 카테고리 조회 -->
  <select id="read" resultType="dev.mvc.category.CategoryVO" parameterType="int">
    SELECT cate_no, cate_name, cate_cnt, cate_seqno, cate_visible
    FROM category
    WHERE cate_no = #{cate_no}
  </select>
  
  <!-- 카테고리 수정 -->
  <update id="update" parameterType="dev.mvc.category.CategoryVO">
    UPDATE category
    SET cate_name= #{cate_name}, cate_seqno = #{cate_seqno}, cate_visible= #{cate_visible}
    WHERE cate_no = #{cate_no}
  </update>
  
  <!-- 카테고리 삭제 -->
  <delete id="delete" parameterType="Integer">
    DELETE FROM category
    WHERE cate_no = #{cate_no}
  </delete>
  
  <!-- 카테고리 우선순위 증가 -->
  <update id="update_seqno_forward" parameterType="Integer">
    UPDATE category
    SET cate_seqno = #{cate_seqno} - 1
    WHERE cate_no = #{cate_no}
  </update>
  
  <!-- 카테고리 우선순위 낮춤 -->
  <update id="update_seqno_backward" parameterType="Integer">
    UPDATE category
    SET cate_seqno = #{cate_seqno} + 1
    WHERE cate_no = #{cate_no}
  </update>
  
  <!-- 카테고리 공개 설정 -->
  <update id="update_visible_y" parameterType="int">
    UPDATE category
    SET cate_visible= #{cate_visible}
    WHERE cate_no= #{cate_no}
  </update>
  
  <!-- 카테고리 비공개 설정 -->
  <update id="update_visible_n" parameterType="int">
    UPDATE category
    SET cate_visible= #{cate_visible}
    WHERE cate_no= #{cate_no}
  </update>
  
  <!-- 회원/비회원에게 공개할 카테고리 목록 -->
  <select id="list_all_cate_name" resultType="dev.mvc.category.CategoryVO" parameterType="String">
    SELECT cate_no, cate_name, cate_cnt, cate_seqno, cate_visible
    FROM category
    WHERE cate_name= #{cate_name} AND cate_visible= 'Y'
    ORDER BY cate_seqno ASC
  </select>
  
  <!-- 관리자용 검색 목록 -->
  <select id="list_search" resultType="dev.mvc.category.CategoryVO">
    SELECT cate_no, cate_name, cate_cnt, cate_seqno, cate_visible
    FROM category
    
    <if test="word != null and word != ''">
      WHERE UPPER(cate_name) LIKE '%' || UPPER(#{word}) || '%'
    </if>
    
    ORDER BY cate_seqno ASC
  </select>
  
  <!-- 관리자용 검색 목록 페이지 -->
  <select id="list_search_paging" resultType="dev.mvc.category.CategoryVO" parameterType="Map">
    SELECT cate_no, cate_name, cate_cnt, cate_seqno, cate_visible, r
    FROM (
        SELECT  cate_no, cate_name, cate_cnt, cate_seqno, cate_visible, rownum as r
        FROM (
            SELECT  cate_no, cate_name, cate_cnt, cate_seqno, cate_visible,
            FROM category
            
            <if test="word != null and word != ''">
              WHERE UPPER(cate_name) LIKE '%' || UPPER(#{word}) || '%'
            </if>
         
            ORDER BY cate_seqno ASC
        )
    )
    WHERE r &gt; = #{start_num} AND r &lt; = #{end_num} <!-- WHERE r >= 1 AND r <= 3 -->
  </select>
  
  <!-- 검색된 레코드 갯수 -->
  <select id="list_search_count" resultType="int" parameterType="String">
    SELECT COUNT(*) as cnt
    FROM category
    
    <if test="word != null and word != ''">
       WHERE UPPER(cate_name) LIKE '%' || UPPER(#{word}) || '%'
    </if>
    
     ORDER BY cate_seqno ASC
  </select>
  
 </mapper>
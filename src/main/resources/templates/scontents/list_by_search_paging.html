<!DOCTYPE html>
<html layout:decorate="~{layout}">
<!-- layout.html 상속-->
<div layout:fragment="content">
  <script>
  function whole_delete(){
	  if(confirm(" 전체 삭제하시겠습니까?")){
	  let checkboxes = document.querySelectorAll('Input[name="scon_no"]');
	  checkboxes.forEach(checkbox =>{
		  checkbox.checked=true;
	  });
	  select_delete();
  }
 }
  
    function select_delete(){
     let checkboxes = document.querySelectorAll('input[name="scon_no"]:checked');
     let sconnos=[];
     checkboxes.forEach((checkboxes) =>{
       sconnos.push(checkboxes.value);
     });
     let querystring = sconnos.map(sconno=>`scon_no=${sconno}`).join('&');
     let url = `./select_delete?${querystring}`;
     console.log(url);
     
     fetch(url,{
       method:'GET',
     })
     .then(response => response.json())
     .then(rdata =>{
       if(rdata.cnt>0){
         console.log('삭제성공');
         window.location.reload();
     }
       else { 
       console.log('삭제 실패');
       }
    })
     .catch(error => {
       console.error('Error.' ,error);
     })
   }
    
  </script>
	<div class='title_line'>
		<span th:if="${word != ''}" th:text="|> ${word} (${search_count} 건)|"
			class="title_line_text"></span>
		<span th:if="${tag_no != 0} and ${hashtag != null}" th:text="|> ${hashtag.tag_name} (${count} 건)|" class="title_line_text"></span>
	</div>

	<aside class="aside_right">
		<a th:href="@{|/scontents/create?cate_no=${categoryVO.cate_no}|}">등록</a> <span class="menu_devide">│</span> <a
			href="javascript:location.reload();">새로고침</a> <span
			class='menu_divide'>│</span> <a
			th:href="@{|./list_by_search?word=${word}&now_page=${now_page}|}">목록형</a>
	</aside>

	<!-- /contents/list_search_component.html 파일의 list_search_fragment import -->
	<div
		th:replace="~{scontents/list_search_component::list_search_fragment}"></div>

	<div class='menu_line'></div>
	
<div style="display: flex;">
    <div th:each="hashtag, status:${list_hashtag}" th:attr="onclick=|location.href='/scontents/read_hashtag/${hashtag.tag_no}?cate_no=1'|" style="cursor: pointer; margin-right: 10px;">
        <span style="font-weight: bold;" th:text="${hashtag.tag_name}"></span>
    </div>
</div>
    
	<table class="table table-striped" style='width: 100%;'>
		<colgroup>
			<col style='width: 10%;' />
			<col style='width: 90%;' />
		</colgroup>
		

    <thead>
      <button type="button" onclick="select_delete()" class="btn btn-secondary btn-sm"  style="margin-right:10px;">선택삭제</button>
      <button type="button" onclick="whole_delete()" class="btn btn-secondary btn-sm">전체삭제</button>
        <tr>
            <th class="th_bs">파일</th>
            <th class="th_bs">제목</th>
        </tr>
    </thead>

    <tbody>
        <!-- 해시태그 -->


<tr th:if="${list_image.size() > 0}">
    <td class='td_basic' style="vertical-align: middle; text-align: center;">
        <div th:each="share_imageVO, status:${list_image}">
            <div th:if="${share_imageVO.file_origin_name.endsWith('jpg') or share_imageVO.file_origin_name.endsWith('png') or share_imageVO.file_origin_name.endsWith('gif')}">
                <img th:src="@{|/contents/storage/${share_imageVO.file_thumb_name}|}" style="width: 120px; height: 90px;">
            </div>
            <div th:if="${((share_imageVO.file_origin_name.endsWith('jpg') or share_imageVO.file_origin_name.endsWith('png') or share_imageVO.file_origin_name.endsWith('gif')) == false) and (share_imageVO.file_size > 0)}">
                <span th:text="${share_imageVO.file_origin_name}"></span>
            </div>
        </div>
    </td>
    <td>
<div th:each="scontentsVO, status:${list}" style="cursor: pointer; margin-left: 30px;">
    <div class='td_basic' th:attr="onclick=|location.href='/scontents/read?cate_no=1&scon_no=${scontentsVO.scon_no}'|" style="cursor: pointer;">
        <span style="font-size: 1em;" th:text="${scontentsVO.scon_views}"></span><br>
        <br>
        <span th:text="${scontentsVO.scon_title}" style="font-weight: bold;"></span><br>
        <span th:if="${scontentsVO.scon_contents.length() > 160 }" th:text="|${scontentsVO.scon_contents.substring(0, 160)}...|"></span>
        <span th:if="${scontentsVO.scon_contents.length() <= 160 }" th:text="|${scontentsVO.scon_contents}|"></span>
    </div>
    <input type="checkbox" th:id="'scon_no_' + ${scontentsVO.scon_no}" name="scon_no" th:value="${scontentsVO.scon_no}">
</div>

    </td>
</tr>

        <!-- 리스트가 비어있을 때 -->
        <tr th:if="${list_image.size() == 0}">
            <td colspan="2" style="text-align: center;">관련된 이미지가 없습니다.</td>
        </tr>
    </tbody>
</table>

	<!-- 페이지 버튼 목록 출력 시작 -->
	<div class="bottom_menu" th:utext="${paging}"></div>
	<!-- 페이지 버튼 목록 출력 종료 -->

</div>
</html>

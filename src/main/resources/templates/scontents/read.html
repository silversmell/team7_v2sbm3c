<!DOCTYPE html> 

<html layout:decorate="~{layout}"> <!-- layout.html 상속-->
<div layout:fragment="content">
  
    <script>
    function submit_comment() {
      let today = new Date();
      let year = today.getFullYear(); 
      let month = today.getMonth() + 1; 
      let date = today.getDate(); 
      let hours = today.getHours(); 
      let minutes = today.getMinutes(); 
      let seconds = today.getSeconds(); 
      
      let formattedDate = year + '-' + month + '-' + date + ' ' + hours + ':' + minutes + ':' + seconds;
      
      let comment = document.getElementById("comment")
      
      let comment_value = comment.value;
      console.log(comment.value)
     
      let scon_no = document.getElementById("scon_no")
      console.log(scon_no.value)
      let url = './create_comment?scmt_comment='+comment.value+'&scon_no='+scon_no.value ;
      
      fetch(url,{
        method: 'GET'
      })
      .then(response => response.json())
      .then(rdata=>{
          if(rdata.cnt>0){
          let commentSection=document.getElementById("commentSection");
          let comment_value = document.getElementById("comment").value;
          
          let new_Comment = document.createElement("div");
          new_Comment.classList.add("td_left");
          new_Comment.style.borderBottom = "none"; 
          
          new_Comment.appendChild(document.createElement("br"));
          
          let scmtDateSpan = document.createElement("span");
          scmtDateSpan.textContent =  formattedDate;
          new_Comment.appendChild(scmtDateSpan);
          
          new_Comment.appendChild(document.createElement("br"));
          
          let new_commentSpan = document.createElement("span");
          new_commentSpan.textContent = comment_value;
          new_commentSpan.fontWeight = "bold";
          
          
          new_Comment.appendChild(new_commentSpan);
          commentSection.appendChild(new_Comment);
          }
          else{
           id_msg.innerHTML= '댓글 등록이 안됩니다.';
        }

      })
      .catch(error =>{
        console.error("Error")
      });
      
    }
  </script>

  <div class='title_line'>
    <span th:text="${scontentsVO.scon_title}" class="title_line_text"></span > 
    > 글 조회
  </div>
  
  <aside class="aside_right" >
    <a href="./create">등록</a>
    <span class='menu_divide' >│</span>
    <a th:href="@{|./update_text?scon_no=${scontentsVO.scon_no}|}">글 수정</a>
    <span class='menu_divide' >│</span>
    <a th:href="@{|/update_file?scon_no=${scontentsVO.scon_no}|}">파일 수정</a>  
    <span class='menu_divide' >│</span>
    <a th:href="@{|./delete?scon_no=${scontentsVO.scon_no}|}">삭제</a>  
    <span class='menu_divide' >│</span>

    <a href="javascript:location.reload();">새로고침</a>

  </aside> 
<!--  
  <aside class="aside_right" th:if="${session.grade != 'admin'}">
     <a href="javascript:location.reload();">새로고침</a>
    <span class='menu_divide' >│</span>    
    <a th:href="@{|./list_by_cateno?cateno=${cateVO.cateno }&word=${word }&now_page=${now_page}|}">목록형</a>    
    <span class='menu_divide' >│</span>
    <a th:href="@{|./list_by_cateno_grid?cateno=${cateno }&word=${word }&now_page=${now_page}|}">갤러리형</a>
  </aside> 
 -->
  <div class='menu_line'></div>

  <fieldset class="fieldset_basic">
    <ul>
      <li class="li_none">
        <div style="width: 100%; word-break: break-all;">
        <!--  
          <div th:if="${scontentsVO.file1.endsWith('jpg') or scontentsVO.file1.endsWith('png')  or scontentsVO.file1.endsWith('gif')}">
            <img th:src="@{|/scontents/storage/${scontentsVO.file1saved}|}" style='width: 50%; float: left; margin-top: 0.5%; margin-right: 1%;'>
          </div>
					-->
					
          <span style="font-size: 1.5em; font-weight: bold;" th:text="${scontentsVO.scon_title}"></span>
          <span style="font-size: 1em;" th:text="${scontentsVO.scon_date}"></span><br><br>
          <span style="font-size: 1em;" th:text="|조회수: ${scontentsVO.scon_views}|"></span><br><br>
          <span style="font-size: 1em;" th:text="|댓글수: ${scontentsVO.scon_views}|"></span><br><br>
          <div style="white-space: pre-wrap;"><span th:text="${scontentsVO.scon_contents}"></span></div>
        </div>
      </li>
      <div>
      <a style="font-size: 1em;" th:href="${url_list0}">Link1</a>
      <a style="font-size: 1em;" th:href="@{|${url_list1}|}">Link2</a>
      <a style="font-size: 1em;" th:href="@{|${url_list2}|}">Link3</a>
      <a style="font-size: 1em;" th:href="@{|${url_list3}|}">Link4</a>
      <a style="font-size: 1em;" th:href="@{|${url_list4}|}">Link5</a>
      </div>
       <!--  
      <li class="li_none" th:text="|검색어(키워드): ${scontentsVO.word }|">
      </li>-->
      <!-- 
      <li class="li_none" th:if="${scontentsVO.size1 > 0}">
        <div >
          <! ServletRegister.java: registrationBean.addUrlMappings("/download"); --> 
         <!--  
          첨부 파일: <a th:href='@{|/download?dir=/scontents/storage&filename=${scontentsVO.file1saved}&downname=${scontentsVO.file1}|}'
                             th:text='|${scontentsVO.file1}|'></a> <span th:text="|(${scontentsVO.size1_label})|"></span>  
        </div>
       
      </li>  
       -->
    </ul>
    <div id="commentSection">
        <tr th:each="scommentVO, status:${list}">      
      <td class='td_left'>
      <span id="scmt_date" style="font-size: 1em;" th:text="${scommentVO.scmt_date}"></span><br>
      <span id="acc_no"style="font-size: 1em;" th:text="${scommentVO.acc_no}"></span><br>
        <span id="scmt_comment" th:text="${scommentVO.scmt_comment}" style="font-weight: bold;"></span><br><br>
      </td>
    </tr>
    </div>
  </fieldset>
  
      <div>
       <label for="comment">댓글</label>
       <input type="hidden" id="scon_no" name="scon_no" th:value="${scontentsVO.scon_no}">
       <textarea name='scmt_comment' id="comment" required="required" value="" class="form-control" rows="5" style='width: 100%;'></textarea>
      <button type='button' onclick="submit_comment();" 
             class="btn btn-primary btn-sm" style="margin-top: 4px;">등록</button>
    </div>
    
    <span id='id_msg'></span>  

</div>

</html>

